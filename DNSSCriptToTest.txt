#!/bin/bash

TARGET_DOMAIN="$1"
OUTPUT_DIRECTORY="results"
OUTPUT_FILE_PREFIX="${OUTPUT_DIRECTORY}/${TARGET_DOMAIN}"

mkdir -p "${OUTPUT_DIRECTORY}"

# Information Gathering
nmap -p- -sV -T4 -oA ${OUTPUT_FILE_PREFIX}_nmap_scan ${TARGET_DOMAIN}

# DNS Enumeration
dnsenum --enum -f /usr/share/dnsenum/dns.txt -o ${OUTPUT_FILE_PREFIX}_dnsenum.xml ${TARGET_DOMAIN}

# DNS Zone Transfers
host -t ns ${TARGET_DOMAIN} > ${OUTPUT_FILE_PREFIX}_nameservers.txt
while read -r nameserver; do
  dig -t axfr @"${nameserver}" ${TARGET_DOMAIN} >> ${OUTPUT_FILE_PREFIX}_zone_transfer.txt
done < ${OUTPUT_FILE_PREFIX}_nameservers.txt

# DNS Cache Snooping
# Note: Replace <nameserver_IP> and <target_to_snoop> with appropriate values
dig +norec +nocookie @<nameserver_IP> <target_to_snoop> > ${OUTPUT_FILE_PREFIX}_cache_snooping.txt

# DNS Amplification Attack
# Note: No example provided due to legal and ethical reasons

# DNSSEC Misconfiguration
dig +dnssec +multi ${TARGET_DOMAIN} > ${OUTPUT_FILE_PREFIX}_dnssec.txt

echo "[*] Penetration testing completed for ${TARGET_DOMAIN}. Results saved in '${OUTPUT_DIRECTORY}' directory."